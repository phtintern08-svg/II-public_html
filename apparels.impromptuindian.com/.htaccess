# Allow API POSTs through ModSecurity
<IfModule mod_security2.c>
    SecRuleRemoveById 949110
    SecRuleRemoveById 920350
    SecRuleRemoveById 920420
    SecRuleRemoveById 930120
    SecRuleRemoveById 942100
    SecRuleRemoveById 942110
    SecRuleRemoveById 942200
    SecRuleRemoveById 942260
</IfModule>

# ================================
# Passenger Python App Config
# ================================

PassengerEnabled on
PassengerAppRoot /home/impromptuindian/Backend
PassengerBaseURI /
PassengerPython /home/impromptuindian/virtualenv/Backend/3.13/bin/python

PassengerLogFile /home/impromptuindian/logs/stderr.log
PassengerStdoutLogFile /home/impromptuindian/logs/stdout.log
PassengerFriendlyErrorPages off
PassengerShowVersionInHeader off

# ===============================
# Impromptu Indian â€“ Flask + SPA
# ===============================

# -------------------------------------------------
# Rewrite Rules - Safe and Simple
# -------------------------------------------------
RewriteEngine On

# Let Passenger handle all API routes
RewriteRule ^api(/.*)?$ - [L]

# Serve real files directly
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# SPA fallback (only for frontend routes)
RewriteRule ^ index.html [L]
# -------------------------------------------------
# 6. Security headers
# -------------------------------------------------
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# -------------------------------------------------
# 7. Block sensitive files
# -------------------------------------------------
<FilesMatch "\.(env|pyc|log|sql|md|bak|tmp)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# -------------------------------------------------
# 8. Allow static assets
# -------------------------------------------------
<FilesMatch "\.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot|mp4|webp|pdf)$">
    Order allow,deny
    Allow from all
</FilesMatch>

# -------------------------------------------------
# 9. Compression
# -------------------------------------------------
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript application/javascript application/json
</IfModule>

