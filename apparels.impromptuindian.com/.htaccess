# ================================
# ImpromptuIndian – Flask + Passenger
# ================================

PassengerEnabled on
PassengerAppRoot /home/impromptuindian/Backend
PassengerBaseURI /
PassengerPython /home/impromptuindian/virtualenv/backend/3.11/bin/python

PassengerLogFile /home/impromptuindian/logs/stderr.log
PassengerStdoutLogFile /home/impromptuindian/logs/stdout.log
PassengerFriendlyErrorPages off
PassengerShowVersionInHeader off

# -------------------------------
# Rewrite Engine
# -------------------------------
RewriteEngine On

# Never rewrite API requests – let Flask handle them
RewriteRule ^api(/.*)?$ - [L]

# Serve existing files directly
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# SPA routing – everything else goes to index.html
RewriteRule ^ index.html [L]

# -------------------------------
# Security headers
# -------------------------------
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# -------------------------------
# Block sensitive files
# -------------------------------
<FilesMatch "\.(env|py|pyc|log|sql|md|bak|tmp)$">
    Require all denied
</FilesMatch>

# -------------------------------
# Allow static assets
# -------------------------------
<FilesMatch "\.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot|mp4|webp|pdf)$">
    Require all granted
</FilesMatch>

# -------------------------------
# Compression
# -------------------------------
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/css application/javascript application/json
</IfModule>

# php -- BEGIN cPanel-generated handler, do not edit
# Set the “ea-php82” package as the default “PHP” programming language.
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php82 .php .php8 .phtml
</IfModule>
# php -- END cPanel-generated handler, do not edit
